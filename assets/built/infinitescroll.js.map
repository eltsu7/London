{"version":3,"file":"infinitescroll.js","sources":["infinitescroll.js"],"sourcesContent":["/**\r\n * Infinite Scroll\r\n */\r\n\r\nfunction initInfiniteScroll(window, document) {\r\n    // next link element\r\n    var nextElement = document.querySelector('link[rel=next]');\r\n    if (!nextElement) return;\r\n\r\n    // post feed element\r\n    var feedElement = document.querySelector('.post-feed');\r\n    if (!feedElement) return;\r\n\r\n    var buffer = 300;\r\n\r\n    var ticking = false;\r\n    var loading = false;\r\n\r\n    var lastScrollY = window.scrollY;\r\n    var lastWindowHeight = window.innerHeight;\r\n    var lastDocumentHeight = document.documentElement.scrollHeight;\r\n\r\n    function onPageLoad() {\r\n        if (this.status === 404) {\r\n            window.removeEventListener('scroll', onScroll);\r\n            window.removeEventListener('resize', onResize);\r\n            return;\r\n        }\r\n\r\n        // append contents\r\n        var postElements = this.response.querySelectorAll('.post-card');\r\n        postElements.forEach(function (item) {\r\n            feedElement.appendChild(item);\r\n        });\r\n\r\n        // set next link\r\n        var resNextElement = this.response.querySelector('link[rel=next]');\r\n        if (resNextElement) {\r\n            nextElement.href = resNextElement.href;\r\n        } else {\r\n            window.removeEventListener('scroll', onScroll);\r\n            window.removeEventListener('resize', onResize);\r\n        }\r\n\r\n        // sync status\r\n        lastDocumentHeight = document.documentElement.scrollHeight;\r\n        ticking = false;\r\n        loading = false;\r\n    }\r\n\r\n    function onUpdate() {\r\n        // return if already loading\r\n        if (loading) return;\r\n\r\n        // return if not scroll to the bottom\r\n        if (lastScrollY + lastWindowHeight <= lastDocumentHeight - buffer) {\r\n            ticking = false;\r\n            return;\r\n        }\r\n\r\n        loading = true;\r\n\r\n        var xhr = new window.XMLHttpRequest();\r\n        xhr.responseType = 'document';\r\n\r\n        xhr.addEventListener('load', onPageLoad);\r\n\r\n        xhr.open('GET', nextElement.href);\r\n        xhr.send(null);\r\n    }\r\n\r\n    function requestTick() {\r\n        ticking || window.requestAnimationFrame(onUpdate);\r\n        ticking = true;\r\n    }\r\n\r\n    function onScroll() {\r\n        lastScrollY = window.scrollY;\r\n        requestTick();\r\n    }\r\n\r\n    function onResize() {\r\n        lastWindowHeight = window.innerHeight;\r\n        lastDocumentHeight = document.documentElement.scrollHeight;\r\n        requestTick();\r\n    }\r\n\r\n    window.addEventListener('scroll', onScroll, { passive: true });\r\n    window.addEventListener('resize', onResize);\r\n\r\n    requestTick();\r\n};\r\n\r\ninitInfiniteScroll(window, document);\r\n"],"names":["initInfiniteScroll","window","document","feedElement","buffer","ticking","loading","lastScrollY","lastWindowHeight","lastDocumentHeight","nextElement","querySelector","onPageLoad","this","status","removeEventListener","onScroll","onResize","response","querySelectorAll","forEach","item","appendChild","resNextElement","href","documentElement","scrollHeight","onUpdate","xhr","XMLHttpRequest","responseType","addEventListener","open","send","requestTick","requestAnimationFrame","scrollY","innerHeight","passive"],"mappings":"AAIA,SAASA,mBAAmBC,EAAQC,GAEhC,IAIIC,EAGAC,EAEAC,EACAC,EAEAC,EACAC,EACAC,EAdAC,EAAcR,EAASS,cAAc,kBAgBzC,SAASC,IACL,GAAoB,MAAhBC,KAAKC,OAGL,OAFAb,EAAOc,oBAAoB,SAAUC,QACrCf,EAAOc,oBAAoB,SAAUE,GAKtBJ,KAAKK,SAASC,iBAAiB,cACrCC,QAAQ,SAAUC,GAC3BlB,EAAYmB,YAAYD,KAI5B,IAAIE,EAAiBV,KAAKK,SAASP,cAAc,kBAC7CY,EACAb,EAAYc,KAAOD,EAAeC,MAElCvB,EAAOc,oBAAoB,SAAUC,GACrCf,EAAOc,oBAAoB,SAAUE,IAIzCR,EAAqBP,EAASuB,gBAAgBC,aAE9CpB,EADAD,GAAU,EAId,SAASsB,IAEL,IAUIC,EAVAtB,IAGAC,EAAcC,GAAoBC,EAAqBL,EACvDC,GAAU,GAIdC,GAAU,GAENsB,EAAM,IAAI3B,EAAO4B,gBACjBC,aAAe,WAEnBF,EAAIG,iBAAiB,OAAQnB,GAE7BgB,EAAII,KAAK,MAAOtB,EAAYc,MAC5BI,EAAIK,KAAK,QAGb,SAASC,IACL7B,GAAWJ,EAAOkC,sBAAsBR,GACxCtB,GAAU,EAGd,SAASW,IACLT,EAAcN,EAAOmC,QACrBF,IAGJ,SAASjB,IACLT,EAAmBP,EAAOoC,YAC1B5B,EAAqBP,EAASuB,gBAAgBC,aAC9CQ,KA7ECxB,IAGDP,EAAcD,EAASS,cAAc,iBAMrCL,EADAD,IAFAD,EAAS,KAKTG,EAAcN,EAAOmC,QACrB5B,EAAmBP,EAAOoC,YAC1B5B,EAAqBP,EAASuB,gBAAgBC,aAmElDzB,EAAO8B,iBAAiB,SAAUf,EAAU,CAAEsB,SAAS,IACvDrC,EAAO8B,iBAAiB,SAAUd,GAElCiB,KAGJlC,mBAAmBC,OAAQC"}